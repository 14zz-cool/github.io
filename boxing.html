<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Î≥µÏã± Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { background: #22243a; color: #fff; font-family: 'Pretendard', 'Apple SD Gothic Neo', sans-serif; margin:0; text-align:center;}
    .wrap { max-width:530px; margin:24px auto 0 auto; background:#25265a; border-radius:26px; box-shadow:0 8px 44px #0008; padding:28px 10px 32px 10px; position:relative; overflow:hidden;}
    .scoreboard { font-size:1.7em; margin-bottom: 8px; font-weight:900; color: #ffe66b;}
    .roundbar { font-size:1em; margin-bottom:10px; letter-spacing:1px;}
    .gameTitle { font-size:1.55em; margin-top:6px; font-weight:900; letter-spacing:1px; text-shadow:1px 1px 10px #233;}
    .boxers-row {
      width: 100%; max-width: 520px;
      display: flex; flex-direction: row; align-items: flex-end; justify-content: space-between;
      margin: 29px auto 12px auto; min-height: 242px; position: relative;
    }
    .boxer-img {
      width: 162px; height: 206px; /* 15% ÌôïÎåÄ */
      display: flex; align-items: flex-end; justify-content: center;
      position: relative; background: none; margin: 0; padding: 0;
      transition: filter 0.25s, opacity 0.25s;
    }
    .boxer-img img {
      width: 100%; height: 100%; object-fit: contain; background: none;
      user-select: none; pointer-events: none; transition: filter .25s, opacity .25s;
      animation: none;
    }
    .boxer-img.shake img {
      animation: shakeboxer 0.48s cubic-bezier(.42,1.9,.48,.96);
    }
    @keyframes shakeboxer {
      0% {transform: translateX(0);}
      14% {transform: translateX(-13px);}
      28% {transform: translateX(12px);}
      42% {transform: translateX(-9px);}
      60% {transform: translateX(8px);}
      76% {transform: translateX(-5px);}
      100% {transform: translateX(0);}
    }
    .boxer-img.gray img { filter: grayscale(0.82) brightness(0.78); }
    .vs-center {
      position: absolute; left:50%; top:48%; transform:translate(-50%,-50%);
      font-size:1.35em; font-weight:900; color:#ffe66b; text-shadow:2px 2px 8px #232344;
      background:rgba(30,32,68,0.45); border-radius:50%; padding:4px 18px 8px 18px; z-index:3;
      pointer-events:none; white-space:nowrap;
    }
    .hand-emoji {
      position: absolute; top:53%; transform:translateY(-50%);
      font-size:2.3em; z-index:7; pointer-events:none;
      text-shadow: 1px 2px 8px #132, 0 0 8px #fff9;
      filter: drop-shadow(0 2px 8px #122b);
      opacity:1; transition: opacity .4s;
    }
    #playerHandEmoji { left: 31%; }
    #aiHandEmoji { right: 31%; }
    .hand-emoji.hide { opacity:0; }
    .bigmsg, .roundmsg {
      position:absolute; left:0; top:0; right:0; bottom:0; display:flex; align-items:center; justify-content:center; pointer-events:none; z-index:99;
    }
    .bigmsg-inner, .roundmsg-inner {
      background:#232344ee; border-radius:22px; color:#ffd76c; font-size:1.13em; padding:17px 21px 10px 21px;
      box-shadow:0 8px 32px #0009; font-weight:900; animation: popfade 0.8s;
      pointer-events:auto;
      min-width:110px; max-width:80vw;
    }
    @keyframes popfade { 0% {transform:scale(0.7);opacity:0;} 20%{opacity:1;} 65%{transform:scale(1.07);} 100%{transform:scale(1);opacity:1;} }
    .timerbar { font-size:.95em; color:#fd5; margin-bottom:7px;}
    .choices { display:flex; justify-content:center; gap:26px; margin:14px 0;}
    .choice-btn { width:53px; height:53px; font-size:1.35em; border-radius:50%; border:none; background:#45477a; color:#fff; cursor:pointer; transition:.13s; box-shadow:0 3px 12px #0006;}
    .choice-btn:hover { background:#5baaff;}
    .choice-btn:active { transform:scale(0.91);}
    .disabled { opacity:0.4; pointer-events:none;}
    .againbtn, .startbtn { margin:14px 6px 0 6px; padding:10px 25px; border-radius:14px; border:none; background:#5baaff; color:#fff; font-size:.99em; font-weight:800; cursor:pointer; box-shadow:0 3px 18px #0006;}
    #startBtn { display:inline-block; }
    #againBtn { display:none; }
    #finalResult { margin-top:11px; font-size:1.05em; font-weight:900; }
    .ko { color:#ff4242; text-shadow:2px 3px 9px #222; animation:ko-pop .72s cubic-bezier(.3,2,.5,1) 1;}
    @keyframes ko-pop {0%{transform:scale(0.3) rotate(-40deg);} 55%{transform:scale(1.3) rotate(6deg);} 90%{transform:scale(1.06);} 100%{transform:scale(1) rotate(0);}
    }
    .judgement { color:#32e2e2; }
    .star-effect {
      position: absolute; left: 50%; top: 13px;
      transform: translateX(-50%); z-index: 11; pointer-events: none;
      width: 62px; height: 34px; display: flex; justify-content: center; align-items: flex-start; gap:3px;
      animation: spin-stars 1.1s cubic-bezier(.22,1.7,.4,1) 1;
    }
    @keyframes spin-stars {
      0%   { transform: translateX(-50%) rotate(-14deg) scale(0.8);}
      23%  { transform: translateX(-50%) rotate(-10deg) scale(1.11);}
      55%  { transform: translateX(-50%) rotate(13deg) scale(1);}
      100% { transform: translateX(-50%) rotate(0deg) scale(1);}
    }
    .star-effect span {
      font-size: 1.2em; opacity: 0.93;
      animation: star-float .82s cubic-bezier(.11,.9,.6,1) infinite alternate;
    }
    .star-effect span:nth-child(1) { color: #ffe66b; animation-delay: .05s;}
    .star-effect span:nth-child(2) { color: #ffb647; animation-delay: .22s;}
    .star-effect span:nth-child(3) { color: #fffacd; animation-delay: .14s;}
    .star-effect span:nth-child(4) { color: #ffcbe7; animation-delay: .11s;}
    @keyframes star-float {
      from { transform: translateY(0) scale(1);}
      to   { transform: translateY(-10px) scale(1.11);}
    }

    /* victory Ïù¥ÌéôÌä∏ */
    .victory-effect {
      position: absolute;
      left: 50%; top: 3px;
      transform: translateX(-50%);
      display: flex; gap:1px;
      z-index: 25; pointer-events:none;
    }
    .victory-letter {
      font-size: 1.42em;
      font-weight: 900;
      color: #fffc6c;
      opacity: 0;
      transform: scale(1.2);
      text-shadow: 1px 2px 9px #fff, 0 0 7px #ffec87;
      animation: victoryPop 0.43s cubic-bezier(.41,2.2,.5,1) forwards;
    }
    @keyframes victoryPop {
      0% {opacity:0; transform: scale(0.3) rotate(-17deg);}
      60% {opacity:1; transform: scale(1.18) rotate(4deg);}
      100% {opacity:1; transform: scale(1) rotate(0);}
    }

    @media (max-width:650px){
      .wrap{padding:2vw 1vw 6vw 1vw; max-width:99vw;}
      .boxers-row{min-height:62px; max-width:97vw;}
      .boxer-img{width:20vw;height:20vw;}
      .vs-center{font-size:.81em;padding:3px 5px 5px 5px;}
      .bigmsg-inner, .roundmsg-inner{font-size:.57em;padding:4vw 2vw 3vw 2vw;}
      .hand-emoji { font-size:1.13em; }
      #playerHandEmoji { left: 22%; }
      #aiHandEmoji { right: 22%; }
    }
    @media (max-width:400px){
      .scoreboard{font-size:.65em;}
      .roundbar{font-size:.62em;}
      .boxer-img {width:14vw;height:10vw;}
      .choice-btn{width:15px;height:15px;font-size:.57em;}
      .bigmsg-inner, .roundmsg-inner{font-size:.47em;}
      .gameTitle{font-size:.61em;}
      #playerHandEmoji { left: 14%; }
      #aiHandEmoji { right: 14%; }
    }
  </style>
</head>
<body>
  <div class="wrap" id="mainWrap">
    <div class="gameTitle">ü•äÎ≥µÏã± Í∞ÄÏúÑÎ∞îÏúÑÎ≥¥!</div>
    <div style="height:18px;"></div>
    <div class="scoreboard" id="scoreboard"></div>
    <div class="roundbar" id="roundbar"></div>
    <div class="boxers-row" id="boxersRow">
      <div class="boxer-img" id="playerBoxer">
        <img src="https://raw.githubusercontent.com/14zz-cool/mini-game/main/boxer01.png" alt="ÌîåÎ†àÏù¥Ïñ¥ Î≥µÏÑú" id="playerImg">
      </div>
      <div class="hand-emoji" id="playerHandEmoji"></div>
      <div class="vs-center" id="vsCenter">VS</div>
      <div class="hand-emoji" id="aiHandEmoji"></div>
      <div class="boxer-img" id="aiBoxer">
        <img src="https://raw.githubusercontent.com/14zz-cool/mini-game/main/boxer02.png" alt="AI Î≥µÏÑú" id="aiImg">
      </div>
    </div>
    <div class="timerbar" id="timerbar"></div>
    <div class="choices" id="choices"></div>
    <div id="finalResult"></div>
    <button class="startbtn" id="startBtn" style="display:inline-block;">Í≤åÏûÑ ÏãúÏûë</button>
    <button class="againbtn" id="againBtn" style="display:none;">Îã§Ïãú ÏãúÏûë</button>
    <div class="roundmsg" id="roundMsg" style="display:none;">
      <div class="roundmsg-inner" id="roundMsgText"></div>
    </div>
    <div class="bigmsg" id="bigMsg" style="display:none;">
      <div class="bigmsg-inner" id="bigMsgText"></div>
    </div>
  </div>
  <script>
    const handMap = { "rock":"‚úä", "scissors":"‚úåÔ∏è", "paper":"‚úã" };
    const hands = ["rock","scissors","paper"];
    let state = {};
    const scoreboard = document.getElementById('scoreboard');
    const roundbar = document.getElementById('roundbar');
    const playerBoxer = document.getElementById('playerBoxer');
    const aiBoxer = document.getElementById('aiBoxer');
    const playerHandEmoji = document.getElementById('playerHandEmoji');
    const aiHandEmoji = document.getElementById('aiHandEmoji');
    const choices = document.getElementById('choices');
    const timerbar = document.getElementById('timerbar');
    const roundMsg = document.getElementById('roundMsg');
    const roundMsgText = document.getElementById('roundMsgText');
    const bigMsg = document.getElementById('bigMsg');
    const bigMsgText = document.getElementById('bigMsgText');
    const againBtn = document.getElementById('againBtn');
    const startBtn = document.getElementById('startBtn');
    const finalResult = document.getElementById('finalResult');
    const vsCenter = document.getElementById('vsCenter');

    startBtn.onclick = initGame;
    againBtn.onclick = ()=>{ showStart(); };

    function showRingIdle(){
      resetBoxers();
      playerHandEmoji.innerHTML = "";
      aiHandEmoji.innerHTML = "";
    }

    function showStart(){
      startBtn.style.display = "inline-block";
      againBtn.style.display = "none";
      finalResult.innerHTML = "";
      showRingIdle();
      resetEffects();
      scoreboard.innerHTML = "";
      roundbar.textContent = "";
      timerbar.textContent = "";
      choices.innerHTML = "";
    }

    function initGame(){
      startBtn.style.display = "none";
      againBtn.style.display = "none";
      finalResult.innerHTML = "";
      playerBoxer.classList.remove("gray");
      aiBoxer.classList.remove("gray");
      removeVictoryEffect(playerBoxer);
      removeVictoryEffect(aiBoxer);
      state = {
        round:1,
        roundMax:5,
        player:0,
        ai:0,
        history:[],
        inRound:false,
        gameEnd:false,
        timer:null,
        timerLeft:3,
      };
      resetEffects();
      updateUI();
      setTimeout(()=>startRound(),400);
    }

    function startRound(){
      state.inRound = true;
      state.timerLeft = 3;
      state.choiceMade = false;
      resetEffects();
      playerHandEmoji.innerHTML = "";
      aiHandEmoji.innerHTML = "";
      playerBoxer.classList.remove("gray");
      aiBoxer.classList.remove("gray");
      removeVictoryEffect(playerBoxer);
      removeVictoryEffect(aiBoxer);
      updateUI();
      showRoundMsg(`ÎùºÏö¥Îìú ${state.round} ÏãúÏûë!`);
      setTimeout(()=>{
        showChoices();
        startTimer();
      },1100);
    }

    function showRoundMsg(msg){
      roundMsg.style.display="flex";
      roundMsgText.textContent = msg;
      setTimeout(()=>{ roundMsg.style.display="none"; }, 1100);
    }

    function startTimer(){
      timerbar.textContent = `3Ï¥à ÎÇ¥Ïóê ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!`;
      state.timer = setInterval(()=>{
        state.timerLeft -= 1;
        if(state.timerLeft<=0){
          clearInterval(state.timer);
          state.timer = null;
          timerbar.textContent = "";
          if(!state.choiceMade){
            doRound(null); // ÎØ∏ÏÑ†ÌÉù=Ìå®Î∞∞
          }
        } else {
          timerbar.textContent = `${state.timerLeft}Ï¥à ÎÇ¥Ïóê ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!`;
        }
      },1000);
    }

    function showChoices(){
      choices.innerHTML = "";
      hands.forEach(h=>{
        let btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.innerHTML = handMap[h];
        btn.onclick = ()=>{ if(state.inRound){clearInterval(state.timer); doRound(h);} };
        choices.appendChild(btn);
      });
      choices.classList.remove("disabled");
      timerbar.textContent = "3Ï¥à ÎÇ¥Ïóê ÏÑ†ÌÉùÌïòÏÑ∏Ïöî!";
    }

    function hideChoices(){
      choices.classList.add("disabled");
      choices.innerHTML = "";
      timerbar.textContent = "";
    }

    function addStarEffect(targetBoxer){
      const star = document.createElement('div');
      star.className = 'star-effect';
      star.innerHTML = '<span>‚≠êÔ∏è</span><span>üåü</span><span>üí´</span><span>‚ú®</span>';
      targetBoxer.appendChild(star);
      setTimeout(()=>{ star.remove(); }, 1100);
    }

    // VICTORY Ïó∞Ï∂ú
    function showVictoryEffect(targetBoxer){
      removeVictoryEffect(targetBoxer);
      const victory = "victory";
      const cont = document.createElement('div');
      cont.className = "victory-effect";
      for(let i=0;i<victory.length;i++){
        let span = document.createElement("span");
        span.className = "victory-letter";
        span.innerText = victory[i];
        span.style.animationDelay = (i*0.13+0.08) + "s";
        cont.appendChild(span);
      }
      targetBoxer.appendChild(cont);
    }
    function removeVictoryEffect(targetBoxer){
      const v = targetBoxer.querySelector('.victory-effect');
      if(v) v.remove();
    }

    function shakeBoxer(target, cb){
      const boxerDiv = target==='ai'?aiBoxer:playerBoxer;
      boxerDiv.classList.add('shake');
      setTimeout(()=>{
        boxerDiv.classList.remove('shake');
        if(cb) cb();
      }, 480);
    }

    function doRound(playerHand){
      state.inRound = false;
      hideChoices();
      timerbar.textContent = "";
      let aiHand = hands[Math.floor(Math.random()*3)];
      let winner = getWinner(playerHand, aiHand);
      let pName = playerHand?handMap[playerHand]:"(ÎØ∏ÏÑ†ÌÉù)";
      let aName = handMap[aiHand];
      state.history.push({p:playerHand, a:aiHand, winner});
      setTimeout(()=>{
        playerHandEmoji.innerHTML = playerHand ? handMap[playerHand] : "";
        aiHandEmoji.innerHTML = handMap[aiHand];
      }, 60);
      resetBoxers();
      setTimeout(()=>{
        playerBoxer.querySelector('img').setAttribute('alt',`ÌîåÎ†àÏù¥Ïñ¥ Î≥µÏÑú (${pName})`);
        aiBoxer.querySelector('img').setAttribute('alt',`AI Î≥µÏÑú (${aName})`);
      },120);
      setTimeout(()=>{
        if(winner==='tie'){
          showBigMsg("ÎπÑÍ≤ºÏäµÎãàÎã§!", ()=>{ setTimeout(startRound,400); });
        } else if(winner==='player'){
          state.player++;
          showBigMsg("ÌîåÎ†àÏù¥Ïñ¥Ïùò ÌéÄÏπò!", ()=>{
            setTimeout(()=>{
              shakeBoxer('ai', ()=>addStarEffect(aiBoxer));
              setTimeout(nextLogic, 850);
            }, 45);
          });
        } else if(winner==='ai'){
          state.ai++;
          showBigMsg("Ïª¥Ìì®ÌÑ∞Ïùò ÌéÄÏπò!", ()=>{
            setTimeout(()=>{
              shakeBoxer('player', ()=>addStarEffect(playerBoxer));
              setTimeout(nextLogic, 850);
            }, 45);
          });
        }
        updateUI();
      },1450);
    }

    function showBigMsg(msg,cb){
      bigMsg.style.display="flex";
      bigMsgText.textContent = msg;
      setTimeout(()=>{
        bigMsg.style.display="none";
        if(cb) cb();
      }, 900);
    }

    function getWinner(player, ai){
      if(!player) return "ai"; // ÎØ∏ÏÑ†ÌÉù=Ìå®Î∞∞
      if(player===ai) return "tie";
      if( (player==="rock"&&ai==="scissors") ||
          (player==="scissors"&&ai==="paper") ||
          (player==="paper"&&ai==="rock") ) return "player";
      return "ai";
    }

    function updateUI(){
      scoreboard.innerHTML = `ÌîåÎ†àÏù¥Ïñ¥ <b>${state.player}</b> : <b>${state.ai}</b> Ïª¥Ìì®ÌÑ∞`;
      roundbar.textContent = `ÎùºÏö¥Îìú ${state.round} / 5`;
      if(state.gameEnd){
        // ÏäπÎ¶¨Ïûê Î®∏Î¶¨ ÏúÑÏóê victory!
        if(state.player>=state.ai){
          playerBoxer.classList.remove("shake");
          aiBoxer.classList.remove("shake");
          showVictoryEffect(playerBoxer);
        } else {
          playerBoxer.classList.remove("shake");
          aiBoxer.classList.remove("shake");
          showVictoryEffect(aiBoxer);
        }
      }
    }

    function nextLogic(){
      // KO or ÌåêÏ†ï
      let result = "";
      let loser = "";
      if(state.player>=3){
        result = "<span class='ko'>ÌîåÎ†àÏù¥Ïñ¥ KOÏäπ!</span>";
        state.gameEnd = true; loser = "ai";
      } else if(state.ai>=3){
        result = "<span class='ko'>Ïª¥Ìì®ÌÑ∞ KOÏäπ!</span>";
        state.gameEnd = true; loser = "player";
      } else if(state.round>=state.roundMax){
        if(state.player>state.ai){
          result = "<span class='judgement'>ÌîåÎ†àÏù¥Ïñ¥ ÌåêÏ†ïÏäπ!</span>";
          loser = "ai"; state.gameEnd = true;
        } else if(state.ai>state.player){
          result = "<span class='judgement'>Ïª¥Ìì®ÌÑ∞ ÌåêÏ†ïÏäπ!</span>";
          loser = "player"; state.gameEnd = true;
        } else {
          result = "<span class='judgement'>Î¨¥ÏäπÎ∂Ä!</span>";
          state.gameEnd = true; loser = "";
        }
      }
      if(state.gameEnd){
        finalResult.innerHTML = result;
        againBtn.style.display="inline-block";
        // Ìå®Î∞∞Ïûê ÌöåÏÉâÎ∞òÏ†Ñ, ÏäπÏûê victory Ïù¥ÌéôÌä∏
        if(loser==="player"){
          playerBoxer.classList.add("gray");
          aiBoxer.classList.remove("gray");
          showVictoryEffect(aiBoxer);
        } else if(loser==="ai"){
          aiBoxer.classList.add("gray");
          playerBoxer.classList.remove("gray");
          showVictoryEffect(playerBoxer);
        } else {
          playerBoxer.classList.remove("gray");
          aiBoxer.classList.remove("gray");
          removeVictoryEffect(playerBoxer);
          removeVictoryEffect(aiBoxer);
        }
      } else {
        state.round++;
        setTimeout(()=>startRound(),620);
      }
    }

    function resetBoxers(){
      playerBoxer.querySelector('img').src = "https://raw.githubusercontent.com/14zz-cool/mini-game/main/boxer01.png";
      aiBoxer.querySelector('img').src = "https://raw.githubusercontent.com/14zz-cool/mini-game/main/boxer02.png";
      playerHandEmoji.innerHTML = "";
      aiHandEmoji.innerHTML = "";
      playerBoxer.classList.remove("gray");
      aiBoxer.classList.remove("gray");
      removeVictoryEffect(playerBoxer);
      removeVictoryEffect(aiBoxer);
    }

    function resetEffects(){
      playerBoxer.classList.remove("shake");
      aiBoxer.classList.remove("shake");
      playerBoxer.classList.remove("gray");
      aiBoxer.classList.remove("gray");
      removeVictoryEffect(playerBoxer);
      removeVictoryEffect(aiBoxer);
      // Î≥Ñ Ïù¥ÌéôÌä∏ Ï†úÍ±∞
      const stars = document.querySelectorAll('.star-effect');
      stars.forEach(s=>s.remove());
    }

    showStart();
  </script>
</body>
</html>
