<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì»µ ì† ë™ì „ ì°¾ê¸°</title>
  <style>
    body {
      margin: 0;
      background: #1e1e2f;
      font-family: 'Pretendard', 'Apple SD Gothic Neo', sans-serif;
      min-height: 100vh;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center; /* í™”ë©´ ì„¸ë¡œ ì¤‘ì•™ì •ë ¬! */
    }
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100vw;
      min-height: 100vh;
      height: 100vh;
    }
    h1 {
      margin: 40px 0 0 0;
      text-align: center;
      font-size: 2em;
      letter-spacing: 1px;
    }
    #bgm-controls {
      margin-top: 22px;
      margin-bottom: 0px;
      display: flex;
      gap: 14px;
      justify-content: center;
      align-items: center;
      width: 100%;
    }
    .bgm-btn {
      padding: 6px 15px;
      font-size: 10px;
      background: #5baaff;
      color: #fff;
      border: none;
      border-radius: 7px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s;
      outline: none;
      min-width: 48px;
      min-height: 22px;
    }
    .bgm-btn:disabled {
      background: #ccc;
      color: #888;
      cursor: not-allowed;
    }
    #message {
      margin: 14px 0 10px 0; /* í…Œì´ë¸”ê³¼ ê°€ê¹ì§€ë§Œ ê°€ë…ì„± ìœ„í•œ ì ë‹¹í•œ ì—¬ë°± */
      width: 100%;
      text-align: center;
      font-size: 20px;
      height: 28px;
      font-weight: 500;
      display: flex;
      justify-content: center;
      align-items: center;
      min-width: 320px;
    }
    #game-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 100vw;
      max-width: 600px;
      height: 260px;
      position: relative;
    }
    #game-table {
      width: 95vw;
      max-width: 540px;
      height: 180px;
      background: linear-gradient(to bottom, #0f283e 0%, #1e3955 100%);
      border-radius: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.28), inset 0 10px 24px rgba(0,0,0,0.16);
      position: relative;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cup-outer {
      position: absolute;
      transition: left 0.5s cubic-bezier(.64,.09,.36,.95);
      bottom: 25px;
      pointer-events: auto;
    }
    .cup {
      width: 68px; height: 88px;
      background: #fff;
      border-radius: 0 0 36px 36px;
      box-shadow: 0 10px 22px rgba(0,0,0,0.38);
      position: relative;
      cursor: pointer;
      display: flex; align-items: flex-end; justify-content: center;
      transition: transform 0.14s cubic-bezier(.43,1.53,.4,.93);
      opacity: 1;
    }
    .cup.clicked {
      transform: scale(1.08) rotate(-3deg);
      box-shadow: 0 14px 36px #fff3, 0 2px 8px gold;
    }
    .cup.disabled {
      pointer-events: none;
      opacity: 0.58;
      filter: grayscale(30%);
    }
    .coin {
      position: absolute;
      top: 54px;
      left: 50%;
      transform: translateX(-50%);
      width: 22px; height: 22px;
      background: gold;
      border-radius: 50%;
      box-shadow: 0 0 6px 2px gold, 0 1px 9px 1px #eaa623bb;
      display: none;
      z-index: 2;
    }
    .show-coin .coin { display: block; }
    .show-empty::after {
      content: "âŒ";
      position: absolute; left: 50%; top: 64px;
      transform: translateX(-50%);
      color: #e09;
      font-size: 24px;
    }
    #controls {
      margin-top: 18px;
      display: flex;
      gap: 10px;
      justify-content: center;
      width: 100%;
    }
    button {
      padding: 12px 30px;
      font-size: 18px;
      background: #5baaff;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s;
      outline: none;
    }
    button:disabled {
      background: #ccc;
      color: #888;
      cursor: not-allowed;
    }
    #difficulty-controls {
      margin: 16px 0 0 0;
      display: flex;
      gap: 13px;
      justify-content: center;
      align-items: center;
    }
    .diff-btn {
      padding: 4px 11px;
      font-size: 9.5px;
      border-radius: 6px;
      border: none;
      background: #88aaf7;
      color: #fff;
      cursor: pointer;
      font-weight: 600;
      opacity: 0.82;
      min-width: 38px;
      min-height: 20px;
      transition: background 0.2s, opacity 0.2s;
    }
    .diff-btn.active {
      background: #3c69ec;
      color: #fff;
      opacity: 1;
    }
    @media (max-width: 600px) {
      #game-table { width: 98vw; max-width: none; height: 130px; }
      .cup { width: 42px; height: 54px; }
      .coin { width: 14px; height: 14px; top: 33px;}
      .show-empty::after { top: 39px; font-size: 15px; }
      #message { min-width: 160px; font-size: 15px; margin: 9px 0 9px 0; }
      .bgm-btn { padding: 4px 10px; font-size: 8px; min-width: 32px; min-height: 16px;}
      .diff-btn { padding: 3px 7px; font-size: 7.5px; min-width: 26px; min-height: 15px;}
      #difficulty-controls { margin-top: 9px; }
      #controls { margin-top: 9px; }
    }
    a { color: #cce; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div id="container">
    <h1>ì»µ ì† ë™ì „ ì°¾ê¸°</h1>
    <div id="bgm-controls">
      <button id="bgmOn" class="bgm-btn">ğŸµ BGM ì¼œê¸°</button>
      <button id="bgmOff" class="bgm-btn">ğŸ”‡ BGM ë„ê¸°</button>
    </div>
    <div id="game-area">
    <div id="message">ë™ì „ì´ ë“¤ì–´ ìˆëŠ” ì»µì„ ì˜ ê¸°ì–µí•˜ì„¸ìš”!</div>
      <div id="game-table"></div>
    </div>
    <div id="controls">
      <button id="startBtn">ê²Œì„ ì‹œì‘</button>
    </div>
    <div id="difficulty-controls">
      <button class="diff-btn active" id="easyBtn">ì‰¬ì›€</button>
      <button class="diff-btn" id="hardBtn">ì–´ë ¤ì›€</button>
    </div>
    <div style="margin-top: 38px;">
      <a href="index.html">â† ë©”ì¸í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
    <!-- BGM ì˜¤ë””ì˜¤ -->
    <audio id="bgm" loop>
      <source src="https://www.bensound.com/bensound-music/bensound-energy.mp3" type="audio/mpeg">
    </audio>
  </div>
  <script>
    // --- ìƒíƒœ ë° ë³€ìˆ˜ ---
    let state = {
      numCups: 5,
      positions: [],
      cupWidth: 68,
      gap: 32,
      coinIndex: -1,
      isClickable: false,
      isShuffling: false,
      started: false,
      cups: [],
      shuffleTimer: null,
      shuffleCount: 14,  // ì‰¬ì›€: 14, ì–´ë ¤ì›€: 28
      shuffleSpeed: 400, // ì‰¬ì›€: 400, ì–´ë ¤ì›€: 200
      tableWidth: 540,
      difficulty: "easy" // "easy" | "hard"
    };

    const gameTable = document.getElementById('game-table');
    const message = document.getElementById('message');
    const startBtn = document.getElementById('startBtn');
    // BGM ì œì–´
    const bgm = document.getElementById('bgm');
    const bgmOn = document.getElementById('bgmOn');
    const bgmOff = document.getElementById('bgmOff');
    bgm.volume = 0.3;

    bgmOn.onclick = () => {
      bgm.play();
      bgmOn.disabled = true;
      bgmOff.disabled = false;
    };
    bgmOff.onclick = () => {
      bgm.pause();
      bgm.currentTime = 0;
      bgmOn.disabled = false;
      bgmOff.disabled = true;
    };

    // BGM ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
    function setBgmBtnState() {
      if (bgm.paused) {
        bgmOn.disabled = false;
        bgmOff.disabled = true;
      } else {
        bgmOn.disabled = true;
        bgmOff.disabled = false;
      }
    }
    bgm.addEventListener('play', setBgmBtnState);
    bgm.addEventListener('pause', setBgmBtnState);
    setBgmBtnState();

    // ë‚œì´ë„ ë²„íŠ¼
    const easyBtn = document.getElementById('easyBtn');
    const hardBtn = document.getElementById('hardBtn');

    easyBtn.onclick = () => {
      if(state.difficulty === "easy" || state.started) return;
      setDifficulty("easy");
    };
    hardBtn.onclick = () => {
      if(state.difficulty === "hard" || state.started) return;
      setDifficulty("hard");
    };

    function setDifficulty(level) {
      if(level === "easy") {
        state.difficulty = "easy";
        state.shuffleCount = 14;
        state.shuffleSpeed = 400;
        easyBtn.classList.add("active");
        hardBtn.classList.remove("active");
      } else {
        state.difficulty = "hard";
        state.shuffleCount = 28;
        state.shuffleSpeed = 200;
        easyBtn.classList.remove("active");
        hardBtn.classList.add("active");
      }
      drawInitialCups();
    }

    // ì¤‘ì•™ì •ë ¬ìš© ìœ„ì¹˜ ê³„ì‚°
    function getCupPositions(num, tableWidth, cupWidth, gap) {
      const totalWidth = num * cupWidth + (num - 1) * gap;
      const startX = (tableWidth - totalWidth) / 2;
      return Array.from({ length: num }, (_, i) =>
        Math.round(startX + i * (cupWidth + gap))
      );
    }

    // ê²Œì„ ì „(ì´ˆê¸°ìƒíƒœ)ì—ëŠ” ì»µì€ ë³´ì´ì§€ë§Œ í´ë¦­ë¶ˆê°€, ë™ì „ ì—†ìŒ
    function drawInitialCups() {
      const tableWidth = gameTable.offsetWidth;
      state.tableWidth = tableWidth;
      state.positions = getCupPositions(state.numCups, tableWidth, state.cupWidth, tableWidth < 400 ? 12 : state.gap);
      gameTable.innerHTML = '';
      state.cups = [];
      for (let i = 0; i < state.numCups; i++) {
        const outer = document.createElement('div');
        outer.className = 'cup-outer';
        outer.style.left = state.positions[i] + "px";
        outer.dataset.idx = i;
        const cup = document.createElement('div');
        cup.className = 'cup disabled';
        cup.tabIndex = -1;
        const coin = document.createElement('div');
        coin.className = 'coin';
        cup.appendChild(coin);
        outer.appendChild(cup);
        gameTable.appendChild(outer);
        state.cups.push(outer);
      }
      state.isClickable = false;
      state.isShuffling = false;
      state.started = false;
      state.coinIndex = -1;
    }

    function setupCups(showCoin = false) {
      // ê²Œì„ ì§„í–‰ìš©: í´ë¦­ ê°€ëŠ¥, ë™ì „ í‘œì‹œ ì„ íƒì 
      const tableWidth = gameTable.offsetWidth;
      state.tableWidth = tableWidth;
      state.positions = getCupPositions(state.numCups, tableWidth, state.cupWidth, tableWidth < 400 ? 12 : state.gap);
      gameTable.innerHTML = '';
      state.cups = [];
      for (let i = 0; i < state.numCups; i++) {
        const outer = document.createElement('div');
        outer.className = 'cup-outer';
        outer.style.left = state.positions[i] + "px";
        outer.dataset.idx = i;
        const cup = document.createElement('div');
        cup.className = 'cup';
        cup.tabIndex = 0;
        const coin = document.createElement('div');
        coin.className = 'coin';
        if (showCoin && i === state.coinIndex) cup.classList.add('show-coin');
        cup.appendChild(coin);
        outer.appendChild(cup);
        gameTable.appendChild(outer);
        state.cups.push(outer);
        // í´ë¦­ ì´ë²¤íŠ¸ í• ë‹¹
        cup.onclick = handleCupClick;
        cup.onmousedown = () => cup.classList.add('clicked');
        cup.onmouseup = () => cup.classList.remove('clicked');
        cup.onmouseleave = () => cup.classList.remove('clicked');
      }
    }

    function clearShuffle() {
      if (state.shuffleTimer) clearInterval(state.shuffleTimer);
      state.shuffleTimer = null;
    }

    function startGame() {
      clearShuffle();
      message.textContent = 'ë™ì „ì´ ë“¤ì–´ ìˆëŠ” ì»µì„ ì˜ ê¸°ì–µí•˜ì„¸ìš”!';
      startBtn.disabled = true;
      startBtn.textContent = "ê²Œì„ ì¤‘...";
      // ë™ì „ ìœ„ì¹˜ ëœë¤
      state.coinIndex = Math.floor(Math.random() * state.numCups);
      state.isClickable = false;
      state.isShuffling = false;
      state.started = true;
      setupCups(true); // ë™ì „ 2ì´ˆê°„ í‘œì‹œ
      // 2ì´ˆ ë’¤ ì»µ ê°€ë¦¬ê³  ì„ê¸°
      setTimeout(() => {
        setupCups(false);
        shuffleCups();
      }, 2000);
    }

    function shuffleCups() {
      let count = 0;
      message.textContent = "ì»µì„ ì„ìŠµë‹ˆë‹¤...";
      state.isShuffling = true;
      state.shuffleTimer = setInterval(() => {
        let i = Math.floor(Math.random() * state.numCups);
        let j;
        do { j = Math.floor(Math.random() * state.numCups); } while (i === j);
        // ìœ„ì¹˜ swap (left ì• ë‹ˆë©”ì´ì…˜)
        let leftA = state.cups[i].style.left, leftB = state.cups[j].style.left;
        state.cups[i].style.left = leftB;
        state.cups[j].style.left = leftA;
        // cups ë°°ì—´ swap
        [state.cups[i], state.cups[j]] = [state.cups[j], state.cups[i]];
        // coinIndexë„ swap (ë™ì „ì˜ ì‹¤ì œ ìœ„ì¹˜ ì¶”ì !)
        if (state.coinIndex === i) state.coinIndex = j;
        else if (state.coinIndex === j) state.coinIndex = i;
        count++;
        if (count >= state.shuffleCount) {
          clearShuffle();
          state.isShuffling = false;
          state.isClickable = true;
          message.textContent = 'ì´ì œ ì»µì„ ì„ íƒí•˜ì„¸ìš”!';
          startBtn.disabled = false;
          startBtn.textContent = "ë‹¤ì‹œ ì‹œì‘";
          state.started = false;
        }
      }, state.shuffleSpeed);
    }

    function handleCupClick(event) {
      if (!state.isClickable || state.isShuffling) return;
      state.isClickable = false;
      // í˜„ì¬ í´ë¦­ëœ ì»µì´ state.cups ë°°ì—´ì—ì„œ ëª‡ ë²ˆì§¸ì¸ì§€ ì§ì ‘ ê²€ìƒ‰
      const outer = event.target.closest('.cup-outer');
      const idx = state.cups.indexOf(outer);
      // í´ë¦­ íš¨ê³¼
      let cupEl = state.cups[idx].firstChild;
      cupEl.classList.add('clicked');
      setTimeout(() => cupEl.classList.remove('clicked'), 150);
      // ëª¨ë“  ì»µ ê²°ê³¼ ê³µê°œ
      revealCups(idx);
      state.started = false;
    }

    function revealCups(selectedIdx) {
      state.cups.forEach((wrapper, idx) => {
        const cup = wrapper.firstChild;
        if (idx == state.coinIndex) cup.classList.add('show-coin');
        else cup.classList.add('show-empty');
      });
      if (selectedIdx == state.coinIndex) {
        message.textContent = "ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!";
      } else {
        message.textContent = "âŒ í‹€ë ¸ìŠµë‹ˆë‹¤!";
      }
    }

    // ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘
    window.addEventListener('resize', () => {
      if (!state.started && !state.isClickable && !state.isShuffling) drawInitialCups();
      else if (state.started || state.isClickable || state.isShuffling) {
        // ì»µ ìœ„ì¹˜ë§Œ ì¬ì¡°ì •
        const tableWidth = gameTable.offsetWidth;
        state.positions = getCupPositions(state.numCups, tableWidth, state.cupWidth, tableWidth < 400 ? 12 : state.gap);
        state.cups.forEach((w, i) => {
          w.style.left = state.positions[i] + 'px';
        });
      }
    });

    // ìµœì´ˆ ì§„ì…ì‹œ: í•­ìƒ ì»µ ë³´ì„, í´ë¦­ë¶ˆê°€
    drawInitialCups();

    startBtn.onclick = startGame;

  </script>
</body>
</html>
